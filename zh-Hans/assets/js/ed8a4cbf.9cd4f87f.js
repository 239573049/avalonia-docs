"use strict";(self.webpackChunkavalonia_docs=self.webpackChunkavalonia_docs||[]).push([[21594],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var i=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=i.createContext({}),c=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=c(e.components);return i.createElement(s.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},v=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=c(n),v=a,m=p["".concat(s,".").concat(v)]||p[v]||u[v]||o;return n?i.createElement(m,r(r({ref:t},d),{},{components:n})):i.createElement(m,r({ref:t},d))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,r=new Array(o);r[0]=v;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:a,r[1]=l;for(var c=2;c<o;c++)r[c]=n[c];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}v.displayName="MDXCreateElement"},35014:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var i=n(87462),a=(n(67294),n(3905));const o={id:"view-activation",title:"View Activation"},r=void 0,l={unversionedId:"guides/deep-dives/reactiveui/view-activation",id:"version-0.10.x/guides/deep-dives/reactiveui/view-activation",title:"View Activation",description:"For the WhenActivated ReactiveUI feature to work, you need to use custom base classes from the Avalonia.ReactiveUI package, such as ReactiveWindow or ReactiveUserControl. Of course, you can also implement the IViewFor interface by hand in your class, but make sure you store the ViewModel in an AvaloniaProperty.",source:"@site/i18n/zh-Hans/docusaurus-plugin-content-docs/version-0.10.x/guides/deep-dives/reactiveui/view-activation.md",sourceDirName:"guides/deep-dives/reactiveui",slug:"/guides/deep-dives/reactiveui/view-activation",permalink:"/avalonia-docs/zh-Hans/docs/guides/deep-dives/reactiveui/view-activation",draft:!1,editUrl:"https://github.com/AvaloniaUI/avalonia-docs/tree/main/versioned_docs/version-0.10.x/guides/deep-dives/reactiveui/view-activation.md",tags:[],version:"0.10.x",frontMatter:{id:"view-activation",title:"View Activation"},sidebar:"documentationSidebar",previous:{title:"ReactiveUI",permalink:"/avalonia-docs/zh-Hans/docs/guides/deep-dives/reactiveui/"},next:{title:"Routing",permalink:"/avalonia-docs/zh-Hans/docs/guides/deep-dives/reactiveui/routing"}},s={},c=[{value:"Activation Example",id:"activation-example",level:3},{value:"Code-Behind ReactiveUI Bindings",id:"code-behind-reactiveui-bindings",level:3}],d={toc:c},p="wrapper";function u(e){let{components:t,...n}=e;return(0,a.kt)(p,(0,i.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"For the ",(0,a.kt)("a",{parentName:"p",href:"https://reactiveui.net/docs/handbook/when-activated/"},"WhenActivated")," ReactiveUI feature to work, you need to use custom base classes from the ",(0,a.kt)("inlineCode",{parentName:"p"},"Avalonia.ReactiveUI")," package, such as ",(0,a.kt)("inlineCode",{parentName:"p"},"ReactiveWindow<TViewModel>")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"ReactiveUserControl<TViewModel>"),". Of course, you can also implement the ",(0,a.kt)("inlineCode",{parentName:"p"},"IViewFor<TViewModel>")," interface by hand in your class, but make sure you store the ",(0,a.kt)("inlineCode",{parentName:"p"},"ViewModel")," in an ",(0,a.kt)("inlineCode",{parentName:"p"},"AvaloniaProperty"),"."),(0,a.kt)("h3",{id:"activation-example"},"Activation Example"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"ViewModel.cs")),(0,a.kt)("p",null,"This view model implements the ",(0,a.kt)("inlineCode",{parentName:"p"},"IActivatableViewModel")," interface. When the corresponding view gets attached to the visual tree, the code inside the WhenActivated block will get called. When the corresponding view gets detached from the visual tree, the composite disposable will be disposed. ",(0,a.kt)("inlineCode",{parentName:"p"},"ReactiveObject")," is the base class for ",(0,a.kt)("a",{parentName:"p",href:"https://reactiveui.net/docs/handbook/view-models/"},"view model classes"),", and it implements ",(0,a.kt)("inlineCode",{parentName:"p"},"INotifyPropertyChanged"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},"public class ViewModel : ReactiveObject, IActivatableViewModel\n{\n    public ViewModelActivator Activator { get; }\n\n    public ViewModel()\n    {\n        Activator = new ViewModelActivator();\n        this.WhenActivated((CompositeDisposable disposables) =>\n        {\n            /* handle activation */\n            Disposable\n                .Create(() => { /* handle deactivation */ })\n                .DisposeWith(disposables);\n        });\n    }\n}\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"View.xaml")),(0,a.kt)("p",null,"This is the UI for the view model you see above."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-markup"},'<Window xmlns="https://github.com/avaloniaui"\n        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"\n        Background="#f0f0f0" FontFamily="Ubuntu"\n        MinHeight="590" MinWidth="750">\n  <TextBlock Text="Hello, world!" />\n</Window>\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"View.xaml.cs")),(0,a.kt)("p",null,"This is the code-behind for the ",(0,a.kt)("inlineCode",{parentName:"p"},"View.xaml")," file you see above. Remember to always put a call to ",(0,a.kt)("inlineCode",{parentName:"p"},"WhenActivated")," into your View constructor, otherwise ReactiveUI won't be able to determine when the view model gets activated."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},"public class View : ReactiveWindow<ViewModel>\n{\n    public View()\n    {\n        // ViewModel's WhenActivated block will also get called.\n        this.WhenActivated(disposables => { /* Handle view activation etc. */ });\n        AvaloniaXamlLoader.Load(this);\n    }\n}\n")),(0,a.kt)("h3",{id:"code-behind-reactiveui-bindings"},"Code-Behind ReactiveUI Bindings"),(0,a.kt)("p",null,"The Avalonia XAML engine doesn't generate strongly typed ",(0,a.kt)("inlineCode",{parentName:"p"},"x:Name")," references to controls. The only way to use ",(0,a.kt)("a",{parentName:"p",href:"https://reactiveui.net/docs/handbook/data-binding/"},"code-behind ReactiveUI bindings")," for now is to use the ",(0,a.kt)("inlineCode",{parentName:"p"},"FindControl")," method that will find a control by the name specified in XAML, or to use ",(0,a.kt)("inlineCode",{parentName:"p"},"{Binding Path}")," syntax."),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"FindControl")," method shouldn't be used inside an expression. Instead, create a custom property which calls the ",(0,a.kt)("inlineCode",{parentName:"p"},"FindControl")," method, or store the control in a variable. See the example below illustrating how to use ReactiveUI code-behind bindings with Avalonia."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},"public class View : ReactiveWindow<ViewModel>\n{\n    // Assume the Button control has the Name=\"ExampleButton\" attribute defined in XAML.\n    public Button ExampleButton => this.FindControl<Button>(\"ExampleButton\");\n\n    public View()\n    {\n        this.WhenActivated(disposables => \n        {\n            // Bind the 'ExampleCommand' to 'ExampleButton' defined above.\n            this.BindCommand(ViewModel, x => x.ExampleCommand, x => x.ExampleButton)\n                .DisposeWith(disposables);\n        });\n        AvaloniaXamlLoader.Load(this);\n    }\n}\n")))}u.isMDXComponent=!0}}]);