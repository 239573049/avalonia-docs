"use strict";(self.webpackChunkavalonia_docs=self.webpackChunkavalonia_docs||[]).push([[99584],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>g});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),l=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=l(e.components);return a.createElement(s.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),u=l(n),m=r,g=u["".concat(s,".").concat(m)]||u[m]||d[m]||o;return n?a.createElement(g,i(i({ref:t},p),{},{components:n})):a.createElement(g,i({ref:t},p))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=m;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c[u]="string"==typeof e?e:r,i[1]=c;for(var l=2;l<o;l++)i[l]=n[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},37263:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>c,toc:()=>l});var a=n(87462),r=(n(67294),n(3905));const o={id:"how-to-create-a-custom-data-binding-converter",title:"How to Create a Custom Data Binding Converter"},i="How to Create a Custom Data Binding Converter",c={unversionedId:"guides/data-binding/how-to-create-a-custom-data-binding-converter",id:"guides/data-binding/how-to-create-a-custom-data-binding-converter",title:"How to Create a Custom Data Binding Converter",description:"When one of the built-in data binding converters does not meet your conversion requirements, you can write a custom converter based on the IValueConverter interface. This guide will show you how.&#x20;",source:"@site/i18n/zh-Hans/docusaurus-plugin-content-docs/current/guides/data-binding/how-to-create-a-custom-data-binding-converter.md",sourceDirName:"guides/data-binding",slug:"/guides/data-binding/how-to-create-a-custom-data-binding-converter",permalink:"/avalonia-docs/zh-Hans/docs/next/guides/data-binding/how-to-create-a-custom-data-binding-converter",draft:!1,editUrl:"https://github.com/AvaloniaUI/avalonia-docs/tree/main/docs/guides/data-binding/how-to-create-a-custom-data-binding-converter.md",tags:[],version:"current",frontMatter:{id:"how-to-create-a-custom-data-binding-converter",title:"How to Create a Custom Data Binding Converter"},sidebar:"documentationSidebar",previous:{title:"How To Bind from Code",permalink:"/avalonia-docs/zh-Hans/docs/next/guides/data-binding/binding-from-code"},next:{title:"How To Bind Tabs",permalink:"/avalonia-docs/zh-Hans/docs/next/guides/data-binding/how-to-bind-tabs"}},s={},l=[{value:"Example",id:"example",level:2},{value:"Target Property Type",id:"target-property-type",level:2},{value:"More Information",id:"more-information",level:2}],p={toc:l},u="wrapper";function d(e){let{components:t,...n}=e;return(0,r.kt)(u,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"how-to-create-a-custom-data-binding-converter"},"How to Create a Custom Data Binding Converter"),(0,r.kt)("p",null,"When one of the built-in data binding converters does not meet your conversion requirements, you can write a custom converter based on the ",(0,r.kt)("inlineCode",{parentName:"p"},"IValueConverter")," interface. This guide will show you how."," "),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"To review the ",(0,r.kt)("em",{parentName:"p"},"Microsoft")," documentation for the ",(0,r.kt)("inlineCode",{parentName:"p"},"IValueConverter")," interface, see ",(0,r.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-gb/dotnet/api/system.windows.data.ivalueconverter?view=netframework-4.7.1"},"here"),".")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"As the ",(0,r.kt)("inlineCode",{parentName:"p"},"IValueConverter")," interface was not available in .NET standard 2.0, Avalonia UI  contains a copy in the ",(0,r.kt)("inlineCode",{parentName:"p"},"Avalonia.Data.Converters")," namespace. You can see the API documentation about this interface, ",(0,r.kt)("a",{parentName:"p",href:"https://reference.avaloniaui.net/api/Avalonia.Data.Converters/IValueConverter/"},"here"),".")),(0,r.kt)("p",null,"You must reference a custom converter in some resources before it can be used. This can be at any level in your application. In this example, the custom converter ",(0,r.kt)("inlineCode",{parentName:"p"},"myConverter")," is referenced in the window resources:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-markup"},'<Window xmlns="https://github.com/avaloniaui"\n        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"\n        xmlns:local="clr-namespace:ExampleApp;assembly=ExampleApp">\n\n  <Window.Resources>\n    <local:MyConverter x:Key="myConverter"/>\n  </Window.Resources>\n\n  <TextBlock Text="{Binding Value, Converter={StaticResource myConverter}}"/>\n</Window>\n')),(0,r.kt)("h2",{id:"example"},"Example"),(0,r.kt)("p",null,"This example data binding converter can convert text to specific case from a parameter:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-markup"},'<TextBlock Text="{Binding TheContent, \n    Converter={StaticResource textCaseConverter},\n    ConverterParameter=lower}" />\n')),(0,r.kt)("p",null,"The above XAML assumes that the ",(0,r.kt)("inlineCode",{parentName:"p"},"textCaseConverter")," has been referenced in a resource."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'public class TextCaseConverter : IValueConverter\n{\n    public static readonly TextCaseConverter Instance = new();\n\n    public object? Convert(object? value, Type targetType, object? parameter, \n                                                            CultureInfo culture)\n    {\n        if (value is string sourceText && parameter is string targetCase\n            && targetType.IsAssignableTo(typeof(string)))\n        {\n            switch (targetCase)\n            {\n                case "upper":\n                case "SQL":\n                    return sourceText.ToUpper();\n                case "lower":\n                    return sourceText.ToLower();\n                case "title": // Every First Letter Uppercase\n                    var txtinfo = new System.Globalization.CultureInfo("en-US",false)\n                                    .TextInfo;\n                    return txtinfo.ToTitleCase(sourceText);\n                default:\n                    // invalid option, return the exception below\n                    break;\n            }\n        }\n        // converter used for the wrong type\n        return new BindingNotification(new InvalidCastException(), \n                                                BindingErrorType.Error);\n    }\n\n    public object ConvertBack(object? value, Type targetType, \n                                object? parameter, CultureInfo culture)\n    {\n      throw new NotSupportedException();\n    }\n}\n')),(0,r.kt)("h2",{id:"target-property-type"},"Target Property Type"),(0,r.kt)("p",null,"You may want to write a a custom converter that can switch the output type depending on what the target property requires. You can achieve this becuase the ",(0,r.kt)("inlineCode",{parentName:"p"},"Convert")," method receives a ",(0,r.kt)("inlineCode",{parentName:"p"},"targetType")," argument that you can test with the ",(0,r.kt)("inlineCode",{parentName:"p"},"IsAssignableTo")," function."),(0,r.kt)("p",null,"In this example, the ",(0,r.kt)("inlineCode",{parentName:"p"},"animalConverter")," can find an image, or a text name for a bound ",(0,r.kt)("inlineCode",{parentName:"p"},"Animal")," class object:  "," "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml",metastring:"title='XAML'",title:"'XAML'"},'<Image Width="42" \n       Source="{Binding Animal, Converter={StaticResource animalConverter}}"/>\n<TextBlock \n       Text="{Binding Animal, Converter={StaticResource animalConverter}}" />\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp",metastring:"title='AnimalConverter.cs'",title:"'AnimalConverter.cs'"},'public class AnimalConverter : IValueConverter\n{\n    public static readonly AnimalConverter Instance = new();\n\n    public object? Convert( object? value, Type targetType, \n                                    object? parameter, CultureInfo culture )\n    {\n        if (value is Animal animal)\n        {\n            if (targetType.IsAssignableTo(typeof(IImage)))\n            {\n                img = @"icons/generic-animal-placeholder.png"\n                switch (animal)\n                {\n                    case Dog d:\n                      img = d.IsGoodBoy ? @"icons/dog-happy.png" \n                                                      : @"icons/dog.png";\n                      break;\n                    case Cat:\n                      img = @"icons/cat.png";\n                      break;\n                    // etc. etc.\n                }\n                // see https://docs.avaloniaui.net/docs/guides/data-binding/how-to-create-a-custom-data-binding-converter\n                return BitmapAssetValueConverter.Instance\n                    .Convert(img, typeof(Bitmap), parameter, culture);\n            }\n            else if (targetType.IsAssignableTo(typeof(string)))\n            {\n                return !string.IsNullOrEmpty(animal.NickName) ? \n                    $"{animal.Name} \\"{animal.NickName}\\"" : animal.Name;\n            }\n        }\n        // converter used for the wrong type\n        return new BindingNotification(new InvalidCastException(), \n                                                    BindingErrorType.Error);\n        \n    }\n\n    public object ConvertBack( object? value, Type targetType, \n                                    object? parameter, CultureInfo culture )\n    {\n      throw new NotSupportedException();\n    }\n}\n')),(0,r.kt)("h2",{id:"more-information"},"More Information"),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"For further guidance about how to bind images, see ",(0,r.kt)("a",{parentName:"p",href:"/avalonia-docs/zh-Hans/docs/next/guides/data-binding/how-to-bind-image-files"},"here"),".")))}d.isMDXComponent=!0}}]);