"use strict";(self.webpackChunkavalonia_docs=self.webpackChunkavalonia_docs||[]).push([[63109],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>h});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var i=n.createContext({}),u=function(e){var t=n.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},c=function(e){var t=u(e.components);return n.createElement(i.Provider,{value:t},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=u(a),m=r,h=d["".concat(i,".").concat(m)]||d[m]||p[m]||o;return a?n.createElement(h,l(l({ref:t},c),{},{components:a})):n.createElement(h,l({ref:t},c))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,l=new Array(o);l[0]=m;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s[d]="string"==typeof e?e:r,l[1]=s;for(var u=2;u<o;u++)l[u]=a[u];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},43373:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>u});var n=a(87462),r=(a(67294),a(3905));const o={description:"TUTORIALS - Music Store App"},l="Load Data at Start-up",s={unversionedId:"tutorials/music-store-app/load-data-at-startup",id:"tutorials/music-store-app/load-data-at-startup",title:"Load Data at Start-up",description:"TUTORIALS - Music Store App",source:"@site/i18n/zh-Hans/docusaurus-plugin-content-docs/current/tutorials/music-store-app/load-data-at-startup.md",sourceDirName:"tutorials/music-store-app",slug:"/tutorials/music-store-app/load-data-at-startup",permalink:"/avalonia-docs/zh-Hans/docs/next/tutorials/music-store-app/load-data-at-startup",draft:!1,editUrl:"https://github.com/AvaloniaUI/avalonia-docs/tree/main/docs/tutorials/music-store-app/load-data-at-startup.md",tags:[],version:"current",frontMatter:{description:"TUTORIALS - Music Store App"},sidebar:"documentationSidebar",previous:{title:"Add Data Persistence",permalink:"/avalonia-docs/zh-Hans/docs/next/tutorials/music-store-app/add-data-persistence"},next:{title:"Conclusion",permalink:"/avalonia-docs/zh-Hans/docs/next/tutorials/music-store-app/summary"}},i={},u=[],c={toc:u},d="wrapper";function p(e){let{components:t,...o}=e;return(0,r.kt)(d,(0,n.Z)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"load-data-at-start-up"},"Load Data at Start-up"),(0,r.kt)("p",null,"On this page you will add code to load the user's album collection from disk when the app starts."),(0,r.kt)("p",null,"You have already added code to the business service that can load both the files you will need from disk. All that remains for you to do, is to add some code to the main window view model to handle the start-up."),(0,r.kt)("p",null,"Follow this procedure to add a method to load the user's album collection from disk:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Stop the app if it is running"),(0,r.kt)("li",{parentName:"ul"},"Locate and open the ",(0,r.kt)("strong",{parentName:"li"},"MainWindowViewModel.cs")," file."),(0,r.kt)("li",{parentName:"ul"},"Add the code as shown:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},"private async void LoadAlbums()\n{\n    var albums = (await Album.LoadCachedAsync()).Select(x => new AlbumViewModel(x));\n\n    foreach (var album in albums)\n    {\n        Albums.Add(album);\n    }\n\n    foreach (var album in Albums.ToList())\n    {\n        await album.LoadCover();\n    }\n}\n")),(0,r.kt)("p",null,"As you can see this method uses the business service to load the list of albums from the disk cache. It then transforms each data model (",(0,r.kt)("inlineCode",{parentName:"p"},"Album")," class) into a view model (",(0,r.kt)("inlineCode",{parentName:"p"},"AlbumViewModel")," class). After this all the album view models are added to the observable collection - this will instantly update the UI with the text data for the albums."),(0,r.kt)("p",null,"You will notice that after the JSON album files are loaded, the second loop loads the cover art image files. This provides your user with visual feedback as quickly as possible (in the form of album tiles with text and the placeholder music note icon) about what albums are in the collection. The cover art is then loaded asynchronously. This ensures that the app remains responsive during the image loading process. "," "),(0,r.kt)("p",null,"You next step is to schedule the ",(0,r.kt)("inlineCode",{parentName:"p"},"LoadAlbum")," method to run when the app starts."," "),(0,r.kt)("p",null,"To schedule the method on the main thread, follow this procedure:"," "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Keep the ",(0,r.kt)("strong",{parentName:"li"},"MainWindowViewModel.cs")," file open."),(0,r.kt)("li",{parentName:"ul"},"Add a reference to ",(0,r.kt)("inlineCode",{parentName:"li"},"using System.Reactive.Concurrency;")),(0,r.kt)("li",{parentName:"ul"},"Add this code to the class constructor:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},"RxApp.MainThreadScheduler.Schedule(LoadAlbums);\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Click ",(0,r.kt)("strong",{parentName:"li"},"Debug")," to compile and run the project.")),(0,r.kt)("p",null,(0,r.kt)("img",{src:a(13574).Z,width:"2662",height:"1464"})))}p.isMDXComponent=!0},13574:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image-20210310184202271-5cffbd28d3c99dfb3d9d93481de708ed.png"}}]);