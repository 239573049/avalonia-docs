"use strict";(self.webpackChunkavalonia_docs=self.webpackChunkavalonia_docs||[]).push([[55417],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>m});var o=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=o.createContext({}),p=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},s=function(e){var t=p(e.components);return o.createElement(l.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},h=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),d=p(n),h=a,m=d["".concat(l,".").concat(h)]||d[h]||u[h]||r;return n?o.createElement(m,i(i({ref:t},s),{},{components:n})):o.createElement(m,i({ref:t},s))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=h;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c[d]="string"==typeof e?e:a,i[1]=c;for(var p=2;p<r;p++)i[p]=n[p];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}h.displayName="MDXCreateElement"},78426:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>c,toc:()=>p});var o=n(87462),a=(n(67294),n(3905));const r={description:"CONCEPTS"},i="Unhandled Exceptions",c={unversionedId:"concepts/unhandledexceptions",id:"concepts/unhandledexceptions",title:"Unhandled Exceptions",description:"CONCEPTS",source:"@site/i18n/zh-Hans/docusaurus-plugin-content-docs/current/concepts/unhandledexceptions.md",sourceDirName:"concepts",slug:"/concepts/unhandledexceptions",permalink:"/avalonia-docs/zh-Hans/docs/next/concepts/unhandledexceptions",draft:!1,editUrl:"https://github.com/AvaloniaUI/avalonia-docs/tree/main/docs/concepts/unhandledexceptions.md",tags:[],version:"current",frontMatter:{description:"CONCEPTS"},sidebar:"documentationSidebar",previous:{title:"UI Composition",permalink:"/avalonia-docs/zh-Hans/docs/next/concepts/ui-composition"},next:{title:"The TopLevel",permalink:"/avalonia-docs/zh-Hans/docs/next/concepts/toplevel"}},l={},p=[{value:"Logging",id:"logging",level:2},{value:"The global try-catch",id:"the-global-try-catch",level:2},{value:"Exceptions from another thread",id:"exceptions-from-another-thread",level:2},{value:"Exceptions from Reactive UI",id:"exceptions-from-reactive-ui",level:2}],s={toc:p},d="wrapper";function u(e){let{components:t,...n}=e;return(0,a.kt)(d,(0,o.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"unhandled-exceptions"},"Unhandled Exceptions"),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"Avalonia UI")," does not offer any mechanism to handle exceptions globally and mark this as handled. The reason is, that one cannot know if the exception has been handled correctly and therefore the application may be in an invalid state. Instead it's highly recommend to handle exceptions locally if these can be handled by your application. That said it is still a good idea to log any unhandled exception for further support and debugging."),(0,a.kt)("h2",{id:"logging"},"Logging"),(0,a.kt)("p",null,"We recommend to log exceptions to the console, a file or anywhere else. There are several logging libraries available out there, for example ",(0,a.kt)("a",{parentName:"p",href:"https://serilog.net"},"Serilog")," and ",(0,a.kt)("a",{parentName:"p",href:"https://nlog-project.org"},"NLog"),"."),(0,a.kt)("h2",{id:"the-global-try-catch"},"The global try-catch"),(0,a.kt)("p",null,"You can catch any exception from the main thread, which is also the UI thread in ",(0,a.kt)("em",{parentName:"p"},"Avalonia UI"),", in your ",(0,a.kt)("inlineCode",{parentName:"p"},"Program.cs"),"-file. To do so we just wrap the entire ",(0,a.kt)("inlineCode",{parentName:"p"},"void Main")," in a ",(0,a.kt)("inlineCode",{parentName:"p"},"try")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"catch")," block. In the ",(0,a.kt)("inlineCode",{parentName:"p"},"catch")," block you can log the error, inform the user, send the log file or restart the application."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'// File: Program.cs\n\npublic static void Main(string[] args)\n{\n    try\n    {\n        // prepare and run your App here\n        BuildAvaloniaApp()\n            .StartWithClassicDesktopLifetime(args);\n    }\n    catch (Exception e)\n    {\n        // here we can work with the exception, for example add it to our log file\n        Log.Fatal(e, "Something very bad happened");\n    }\n    finally\n    {\n        // This block is optional. \n        // Use the finally-block if you need to clean things up or similar\n        Log.CloseAndFlush();\n    }\n}\n')),(0,a.kt)("h2",{id:"exceptions-from-another-thread"},"Exceptions from another thread"),(0,a.kt)("p",null,"If you are using ",(0,a.kt)("inlineCode",{parentName:"p"},"Task"),"s to run some work asynchronously, you can setup ",(0,a.kt)("inlineCode",{parentName:"p"},"TaskScheduler.UnobservedTaskException"),". For more information read the ",(0,a.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/dotnet/api/system.threading.tasks.taskscheduler.unobservedtaskexception"},"Microsoft .NET-Documentation"),"."),(0,a.kt)("h2",{id:"exceptions-from-reactive-ui"},"Exceptions from Reactive UI"),(0,a.kt)("p",null,"If you are using Avalonia together with ",(0,a.kt)("a",{parentName:"p",href:"../concepts/the-mvvm-pattern/avalonia-ui-and-mvvm#reactiveui"},"ReactiveUI"),", you can subscribe to their ",(0,a.kt)("inlineCode",{parentName:"p"},"RxApp.DefaultExceptionHandler"),". For more information please refer to ",(0,a.kt)("a",{parentName:"p",href:"https://www.reactiveui.net/docs/handbook/default-exception-handler/"},"ReactiveUI Default Exception Handler"),"."),(0,a.kt)("p",null,"Note, ",(0,a.kt)("inlineCode",{parentName:"p"},"RxApp.DefaultExceptionHandler")," should be set before any ReactiveCommand was created. Otherwise, custom handler won't be used. You can set it in your application entry point or before any Avalonia view or window was created."))}u.isMDXComponent=!0}}]);